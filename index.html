<html>
    <head>
        <title>Spell Haste Calculator</title>
        <script type="text/javascript">
        function calculate() {
            var castingtime = document.getElementById("castingtime").value;
        var casting_speed = 1;
        var haste_rating_buffs = 0;
            if(document.hastecapform.heroism.checked == true) {
                casting_speed *= 1.3;
            }
            if(document.hastecapform.icyveins.checked == true) {
                casting_speed *= 1.2;
            }
            if(document.hastecapform.powerinfusion.checked == true) {
                casting_speed *= 1.2;
            }
            if(document.hastecapform.berserker.checked == true) {
                casting_speed *= 1.2;
            }
            if(document.hastecapform.mqg.checked == true) {
                haste_rating_buffs += 330;
            }
            if(document.hastecapform.quag.checked == true) {
                haste_rating_buffs += 320;
            }
            if(document.hastecapform.tsog.checked == true) {
                haste_rating_buffs += 175;
            }
            if(document.hastecapform.ash.checked == true) {
                haste_rating_buffs += 145;
            }
            if(document.hastecapform.drums.checked == true) {
                haste_rating_buffs += 80;
            }
            if(document.hastecapform.shroud.checked == true) {
                haste_rating_buffs += 32;
            }
            if(document.hastecapform.bont.checked == true) {
                haste_rating_buffs += 28;
            }
            if(document.hastecapform.mont.checked == true) {
                haste_rating_buffs += 38;
            }
            if(document.hastecapform.roa1.checked == true) {
                haste_rating_buffs += 31;
            }
            if(document.hastecapform.roa2.checked == true) {
                haste_rating_buffs += 31;
            }
            if(document.hastecapform.zdgd.checked == true) {
                haste_rating_buffs += 55;
            }
            if(document.hastecapform.waist.checked == true) {
                haste_rating_buffs += 32;
            }
            var haste_rating_buffs_percent = haste_rating_buffs / 15.77 / 100;
            var haste_rating_total = eval(haste_rating_buffs);
            var haste_rating_total_percent = haste_rating_total / 15.77 / 100;
            var casting_speed_haste_rating = 1 + haste_rating_total_percent;
            var casting_speed_total = casting_speed * casting_speed_haste_rating;
            var gcd = 1.5 / (casting_speed * casting_speed_haste_rating);
            // Cap
            var haste_cap_gear_percent = (castingtime / casting_speed - haste_rating_buffs_percent) * 100 - 100;
            document.hastecapform.gear_percent_total.value = round(castingtime * 100 - 100) + "%";
            // Current
            document.hastecapform.gear_percent_current_total.value = round((casting_speed * casting_speed_haste_rating - 1) * 100) + "%";
            document.hastecapform.castingtime_current.value = round(castingtime / casting_speed_total) + "s";
            document.hastecapform.gcd_current.value = round(Math.max(1, gcd)) + "s";
        }
        function round(number) {
            return Math.round(number * 1000) / 1000;
        }
        </script>
    </head>
    <body onload="calculate();document.hastecapform.gear_rating_current.focus();">
        <form method="get" name="hastecapform">
            Cast Time (in seconds)
            <br />
            <input value="1.5" type="number" name="castingtime" id="castingtime" oninput="calculate()">
            <br />
            <br />Haste Buffs
            <br /><input type="checkbox" name="heroism" onclick="calculate()" value="1"> Heroism / Bloodlust (30%)
            <br /><input type="checkbox" name="icyveins" onclick="calculate()" value="1"> Icy Veins (20%)
            <br /><input type="checkbox" name="powerinfusion" onclick="calculate()" value="1"> Power Infusion (20%)</small>
            <br /><input type="checkbox" name="berserker" onclick="calculate()" value="1"> Berserker (20%)
            <br />
            <br />Haste Rating Buffs
            <br /><input type="checkbox" name="ash" onclick="calculate()" value="1"> Ashtongue Talisman of Insight (145 Spellhaste)
            <br /><input type="checkbox" name="drums" onclick="calculate()" value="1"> Drums Of Battle (80 Spellhaste)
            <br /><input type="checkbox" name="mqg" onclick="calculate()" value="1"> Mind Quickening Gem (330 Spellhaste)
            <br /><input type="checkbox" name="bont" onclick="calculate()" value="1"> Bracers of Nimble Thought (28 Spellhaste)
            <br /><input type="checkbox" name="mont" onclick="calculate()" value="1"> Mantle of Nimble Thought (38 Spellhaste)
            <br /><input type="checkbox" name="quag" onclick="calculate()" value="1"> Quagmirran's Eye (320 Spellhaste)
            <br /><input type="checkbox" name="roa1" onclick="calculate()" value="1"> Ring of Ancient Knowledge #1 (31 Spellhaste)
            <br /><input type="checkbox" name="roa2" onclick="calculate()" value="1"> Ring of Ancient Knowledge #2 (31 Spellhaste)
            <br /><input type="checkbox" name="shroud" onclick="calculate()" value="1"> Shroud of the Highborne (32 Spellhaste)
            <br /><input type="checkbox" name="tsog" onclick="calculate()" value="1"> The Skull of Guldan (175 Spellhaste)
            <br /><input type="checkbox" name="waist" onclick="calculate()" value="1"> Waistwrap of Infinity (32 Spellhaste)
            <br /><input type="checkbox" name="zdgd" onclick="calculate()" value="1"> Zhar'doom, Greatstaff of the Devourer (55 Spellhaste)
            <br />
            <br />
            <table border="0">
                <tr>
                    <td></td>
                    <td style="font-weight: bold;">The Cap</td>
                    <td>You</td>
                </tr>
                <tr>
                    <td>Haste</td>
                    <td><input name="gear_percent_total" size="10" style="font-weight: bold;" type="text" disabled></td>
                    <td><input name="gear_percent_current_total" size="10" type="text" disabled></td>
                </tr>
                <tr>
                    <td>Cast Time</td>
                    <td><input size="10" style="font-weight: bold;" type="text" disabled value="1s"></td>
                    <td><input name="castingtime_current" size="10" type="text" disabled></td>
                </tr>
                <tr>
                    <td>GCD</td>
                    <td><input size="10" style="font-weight: bold;" type="text" disabled value="1s"></td>
                    <td><input name="gcd_current" size="10" type="text" disabled></td>
                </tr>
                <tr>
                </table>
            </form>
        </body>
    </html>